/* ===================================================
 * ZOOlanders
 * https://zoolanders.com/extensions/zoolanders
 * ===================================================
 * Copyright (C) JOOlanders SL
 * http://www.gnu.org/licenses/gpl-2.0.html
 * ========================================================== */
!function(a,b,c,d,e){"use strict";b.component("zoolandersExtensions",{init:function(){var a=this;a.initActions(),a.initModal()},initActions:function(){var d=this;d.element.on("click",".zx-x-install",function(c){var d=a(this),e=d.closest("tr"),f=a(".zx-x-uninstall",e);""!==e.data("ext").url&&(c.preventDefault(),d.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"downloadandinstall"}),data:{extensions:[e.data("ext")]}}).done(function(c){var g=b.lang.sprintf("ZL_TIP_REINSTALL",c.ext.title,c.ext.version);d.data("tooltip")?d.data("tooltip").tip=g:d.attr("title",g),a("i",d).attr("class","uk-icon-retweet"),a(".zx-x-version",e).html('<span class="uk-badge uk-badge-notification uk-badge-success">'+c.ext.version+"</span>");var h=a('<a href="#" data-uk-tooltip />');"extension"==c.ext.type&&(1==c.ext.enabled?(h.attr("title",b.lang._("ZL_TIP_STATUS_ENABLED")),h.html('<i class="uk-icon-check uk-text-success"></i>')):(h.attr("title",b.lang._("ZL_TIP_STATUS_DISABLED")),h.html('<i class="uk-icon-times uk-text-danger"></i>')),a(".zx-x-status",e).html(h)),f.removeAttr("disabled")}).always(function(){d.zx("spin.off")}))}),d.element.on("click",".zx-x-uninstall",function(c){c.preventDefault();var d=a(this),e=d.closest("tr"),f=a(".zx-x-install",e);b.notify.closeAll(),b.notify.confirm(b.lang.sprintf("ZL_MSG_CONFIRM_REMOVAL",e.data("ext").title),{status:"warning",timeout:0}).done(function(){d.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"uninstall"}),data:{name:e.data("ext").name}}).done(function(c){if(c.ext.deprecated)e.remove();else{d.prop("disabled",!0);var g=b.lang.sprintf("ZL_TIP_INSTALL",c.ext.title,c.ext.version);f.data("tooltip")?f.data("tooltip").tip=g:f.attr("title",g),a("i",f).attr("class","uk-icon-bolt"),a(".zx-x-version",e).html("---"),a(".zx-x-status",e).html("---")}}).always(function(){d.zx("spin.off")})})}),a(".zx-x-updateall",d.element).on("click",function(c){c.preventDefault();var d=[];a("tr[data-ext]").each(function(b,c){"outdated"===a(c).data("ext").state&&d.push(a(c).data("ext"))}),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"downloadandinstall"}),data:{extensions:d}})}),d.element.on("click",".zx-x-download",function(d){d.preventDefault();var e=a(this),f=e.closest("tr");e.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"downloadAndZip"}),data:{extensions:[f.data("ext")]}}).done(function(a){a.filepath&&(c.location.href=b.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:a.filepath}))}).always(function(){e.zx("spin.off")})}),a("#toolbar-download button").on("click",function(c){c.preventDefault();var d=b.notify(b.lang.get("ZL_MSG_DOWNLOAD_ALL_START")+' <i class="uk-icon-zx-spinner uk-icon-spin"></i>',{timeout:null,group:"downloadall"}),e=[];a("tr[data-ext]").each(function(b,c){e.push(a(c).data("ext"))}),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"downloadAndZip"}),data:{extensions:e}}).done(function(a){if(a.filepath){var c=b.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:a.filepath});d.status("success").content(b.lang.sprintf("ZL_MSG_DOWNLOAD_ALL_SUCCESS",c))}}).fail(function(){d.close(!0)})}),a("#toolbar-langpacks button").on("click",function(c){c.preventDefault();var d=a(this),e=(d.closest("tr"),b.modal.dialog('<div class="uk-text-center"><i class="uk-icon-zx-spinner uk-icon-spin uk-icon-large uk-margin-large-bottom uk-margin-large-top"></i></div>').show());b.ajax.request({url:b.url.get("ajax:",{controller:"zoolanders",task:"getLangList"})}).done(function(a){a.html&&e.content('<a class="uk-modal-close uk-close"></a>'+a.html)}).fail(function(b){var c=[];b.errors&&b.errors.length&&a.each(b.errors,function(){c.push(this)}),b.notices&&b.notices.length&&a.each(b.notices,function(){c.push(this)}),e.content(c.join("<br />"))})}),a("body").on("click",".zx-x-download-lang-packs",function(d){d.preventDefault();var e=a(this);e.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"downloadLangInstaller"}),data:{language:e.closest("li").data("lang-code")}}).done(function(a){a.filepath&&(c.location.href=b.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:a.filepath}))}).always(function(){e.zx("spin.off")})}),a("body").on("click",".zx-x-install-lang-packs",function(c){c.preventDefault();var d=a(this);d.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"installLangPack"}),data:{language:d.closest("li").data("lang-code")}}).done(function(){b.notify(b.lang.sprintf("ZL_MSG_LANG_PACK_INSTALLED","ZOOlanders",d.closest("li").data("lang-name")),{status:"success"})}).always(function(){d.zx("spin.off")})}),d.element.on("click",".zx-x-resource-lang-packs",function(c){c.preventDefault();var d=a(this),e=d.closest("tr"),f=b.modal.dialog('<div class="uk-text-center"><i class="uk-icon-zx-spinner uk-icon-spin uk-icon-large uk-margin-large-bottom uk-margin-large-top"></i></div>').show();b.ajax.request({url:b.url.get("ajax:",{controller:"zoolanders",task:"getResourceLangList"}),data:{title:e.data("ext").title}}).done(function(a){a.html&&f.content('<a class="uk-modal-close uk-close"></a>'+a.html)}).fail(function(b){var c=[];b.errors&&b.errors.length&&a.each(b.errors,function(){c.push(this)}),b.notices&&b.notices.length&&a.each(b.notices,function(){c.push(this)}),f.content(c.join("<br />"))})}),a("body").on("click",".zx-x-download-resource-lang-pack",function(d){d.preventDefault();var e=a(this);e.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"downloadLangInstaller"}),data:{resources:[e.closest("ul").data("resource")],language:e.closest("li").data("lang-code")}}).done(function(a){a.filepath&&(c.location.href=b.url.get("ajax:",{controller:"zoolanders",task:"outputFile",file:a.filepath}))}).always(function(){e.zx("spin.off")})}),a("body").on("click",".zx-x-install-resource-lang-pack",function(c){c.preventDefault();var d=a(this);d.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"installLangPack"}),data:{resources:[d.closest("ul").data("resource")],language:d.closest("li").data("lang-code")}}).done(function(){b.notify(b.lang.sprintf("ZL_MSG_LANG_PACK_INSTALLED",d.closest("ul").data("resource"),d.closest("li").data("lang-name")),{status:"success"})}).always(function(){d.zx("spin.off")})}),d.element.on("click",".zx-x-status",function(c){c.preventDefault();var d=a(this),f=d.closest("tr");d.zx("spin"),b.ajax.requestAndNotify({url:b.url.get("ajax:",{controller:"zoolanders",task:"toggleExtState"}),data:{name:f.data("ext").name},type:"POST"},{group:"statetoggle"}).always(function(a){d.zx("spin.off"),a.new_state!==e&&(1==a.new_state?(d.data("tooltip").tip=b.lang._("ZL_TIP_STATUS_ENABLED"),d.html('<i class="uk-icon-check"></i>')):(d.data("tooltip").tip=b.lang._("ZL_TIP_STATUS_DISABLED"),d.html('<i class="uk-icon-times"></i>')))})})},initModal:function(){var d=this,e=a("#zl-modal-options").detach();a("form",e).on("submit",function(d){d.preventDefault();var e=a(this);a(".uk-button",e).zx("spin"),b.ajax.requestAndNotify({url:e.attr("action")+"&format=raw",type:e.attr("method"),data:e.serializeArray()}).done(function(){c.location.reload(!0)}).always(function(){a(".uk-button",e).zx("spin.off")})}),a("#toolbar-options button").on("click",function(){d.modal=a.UIkit.modal.dialog(e.children()),a(".uk-modal-dialog",d.modal.element).prepend('<a class="uk-modal-close uk-close"></a>'),d.modal.element.wrap(a('<div class="zx" />')),d.modal.show()})}})}(jQuery,jQuery.zx,window,document);