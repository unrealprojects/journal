/* ===================================================
 * ZL Framework
 * https://zoolanders.com/extensions/zl-framework
 * ===================================================
 * Copyright (C) JOOlanders SL
 * http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 only
 * ========================================================== */
!function(a){var b=function(b){this.options=a.extend({},this.options,b),this.events={}};b.prototype=a.extend(b.prototype,a.zlux.Main.prototype,{name:"ElementFilespro",options:{root:"",extensions:"",storage:"",fileMode:"",max_file_size:"",title:"",resize:{}},events:{},initialize:function(b,c){this.options=a.extend({},a.zlux.Main.prototype.options,this.options,c);var d=this;d.element=b,b.on("click","p.add a",function(){d.apply(a("input.filespro",b).add("input.mediapro-element",b))}),d.apply(a("input.filespro",b).add("input.mediapro-element",b))},apply:function(b){var c=this;a.zlux.assets.load("files").done(function(){var d=a.zlux.filesPreview();b.each(function(b,e){var f=a(e);if(!a(e).data("initialized")){var g="filespro-element-"+b,h=f.closest(".row").addClass("zl-bootstrap"),i=f.hasClass("image-element")?!0:!1;f.attr("id",g);var j=a("span.zlux-x-filedata",h).data("zlux-storage");c.dialogTrigger=a('<a title="'+c.options.title+'" class="btn btn-mini zlux-btn-edit" href="#"><i class="icon-edit"></i></a>').appendTo(h),c.dialogTrigger.zlux("filesDialogManager",{extensions:c.options.extensions,max_file_size:c.options.max_file_size,title:c.options.title,storage:j.engine,storage_params:j,root:j.root,resize:c.options.resize}).on("zlux.ObjectSelected",function(b,e,g){if(!("files"==c.options.fileMode&&"file"!=g.type||"folders"==c.options.fileMode&&"folder"!=g.type)){var j=e.getFullPath(g.name);f.val(j).trigger("change"),g.path=j,a(".zlux-preview",h).remove(),h.append(d.renderPreviewDOM(g,i))}});var k=a("span.zlux-x-filedata",h).data("zlux-data");!a.isEmptyObject(k)&&f.val()&&(k.path=f.val(),h.append(d.renderPreviewDOM(k,i))),a('<i class="icon-remove zlux-x-cancel-btn" />').insertAfter(f).on("click",function(){f.val(""),a(".zlux-preview",h).remove()})}f.data("initialized",!0)})})}}),a.fn[b.prototype.name]=function(){var c=arguments,d=c[0]?c[0]:null;return this.each(function(){var e=a(this);if(b.prototype[d]&&e.data(b.prototype.name)&&"initialize"!=d)e.data(b.prototype.name)[d].apply(e.data(b.prototype.name),Array.prototype.slice.call(c,1));else if(!d||a.isPlainObject(d)){var f=new b;b.prototype.initialize&&f.initialize.apply(f,a.merge([e],c)),e.data(b.prototype.name,f)}else a.error("Method "+d+" does not exist on jQuery."+b.name)})}}(jQuery);