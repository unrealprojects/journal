/* ===================================================
 * ZL Framework
 * https://zoolanders.com/extensions/zl-framework
 * ===================================================
 * Copyright (C) JOOlanders SL
 * http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 only
 * ========================================================== */
!function(a){var b=function(){};b.prototype=a.extend(b.prototype,{name:"zluxSaveElement",options:{url:"",msgSaveElement:"Save Element"},initialize:function(b,c){this.options=a.extend({},this.options,c);var d=this;a('<a class="btn btn-small save" href="javascript:void(0);"><i class="icon-ok-sign"></i> '+d.options.msgSaveElement+"</a>").on("click",function(){var b=a(this).addClass("btn-working"),c=b.closest(".element").find("input, textarea").serializeArray();a.post(d.options.url+"&task=saveelement",c,function(){b.removeClass("btn-working")})}).appendTo(b.find(".btn-toolbar"))}}),a.fn[b.prototype.name]=function(){var c=arguments,d=c[0]?c[0]:null;return this.each(function(){var e=a(this);if(b.prototype[d]&&e.data(b.prototype.name)&&"initialize"!=d)e.data(b.prototype.name)[d].apply(e.data(b.prototype.name),Array.prototype.slice.call(c,1));else if(!d||a.isPlainObject(d)){var f=new b;b.prototype.initialize&&f.initialize.apply(f,a.merge([e],c)),e.data(b.prototype.name,f)}else a.error("Method "+d+" does not exist on jQuery."+b.name)})}}(jQuery),function(a){var b=function(){};b.prototype=a.extend(b.prototype,{name:"zluxBrowseFile",options:{url:"",path:"images"},initialize:function(b,c){this.options=a.extend({},this.options,c);var d=this,e=location.href.match(/^(.+)administrator\/index\.php.*/i)[1];b.wrap('<div class="zlux-finder"><div /></div>').zluxDialog({title:"Dialog title",width:600,height:400,classes:"zlux-finder"},function(c){c.content.zluxFinder({dialog:c,url:d.options.url,path:d.options.path}),c.content.on("click",".item.file a",function(){b.val(a(this).closest(".item").data("path"))&&b.trigger("change")})});var f=a('<div class="file-preview zl-bootstrap" />').append(a('<img class="img-polaroid" />')).appendTo(b.parent());b.on("change",function(){f.find("img").attr("src",e+b.val())}).trigger("change"),a("<span>").addClass("input-cancel").insertAfter(b).click(function(){b.val("")})}}),a.fn[b.prototype.name]=function(){var c=arguments,d=c[0]?c[0]:null;return this.each(function(){var e=a(this);if(b.prototype[d]&&e.data(b.prototype.name)&&"initialize"!=d)e.data(b.prototype.name)[d].apply(e.data(b.prototype.name),Array.prototype.slice.call(c,1));else if(!d||a.isPlainObject(d)){var f=new b;b.prototype.initialize&&f.initialize.apply(f,a.merge([e],c)),e.data(b.prototype.name,f)}else a.error("Method "+d+" does not exist on jQuery."+b.name)})}}(jQuery),function(b){var c=function(){};c.prototype=b.extend(c.prototype,{name:"zluxFinder",options:{dialog:{},url:"",path:"images",open:"open",filemanager:!0},initialize:function(c,d){function e(d){d.preventDefault();var h=b(this).closest(".zlux-dialog li",c);h.length||(h=c),h.hasClass("file")||(h.hasClass(g)&&!h.hasClass("reload")?h.removeClass(g).children("ul").slideUp():(h.addClass("loading"),b.post(f.options.url+"&controller=zlframework&task=JSONfiles",{path:h.data("path")},function(d){h.removeClass("loading").addClass(g),f.options.dialog.loaded(),h.children().remove("ul.items"),!d||d.msg||(f.buildItemsTree(d,h),h.find("ul a").on("click",e).on("click",function(){b(this).closest(".zlux-dialog").find(".selected").removeClass("selected"),b(this).closest(".item").addClass("selected")}),h.children("ul").slideDown(),!h.hasClass("reload")||!h.children("ul").length,f.options.filemanager&&(c.data("toolbar-initialized")||(b('<span class="root-folder tools" />').append(b('<span class="zl-btn-small refresh action" title="Refresh" />').bind("click",function(){h.addClass("reload").find("li").addClass("loading"),c.trigger("zluxFinder.retrieve")})).append(b('<span class="zl-btn-small plupload action" title="'+filesPro.translate("Upload files into the main folder")+'" />').bind("click",function(){f.plupload(b(this),"",function(){h.addClass("reload").find("li").addClass("loading"),c.trigger("zluxFinder.retrieve")})})).append(b('<span class="zl-btn-small add action" title="'+filesPro.translate("Create a new folder into the main folder")+'" />').bind("click",function(){f.Prompt(filesPro.translate("Input a name for the new folder"),filesPro.translate("MyFolder"),b(this),function(c){c&&h.find("li").addClass("loading")&&b.post(f.options.url+"&method=newfolder",{path:"",newfolder:c},function(){h.addClass("reload"),a.trigger("zluxFinder.retrieve")},"json")})})).prependTo(c.closest(".ui-dialog").find(".ui-dialog-titlebar")),c.data("toolbar-initialized",!0)),b(".ui-dialog").find(".tools span").qtip({position:{my:"bottom left",at:"top center"},show:{delay:700},style:"ui-tooltip-custom ui-tooltip-light ui-tooltip-rounded ui-tooltip-dialogue"})))},"json")))}this.options=b.extend({},this.options,d);var f=this,g=f.options.open;c.data("path",this.options.path).bind("zluxFinder.retrieve",e).trigger("zluxFinder.retrieve")},buildItemsTree:function(a,c){var d=this;c.append('<ul class="items" />').children("ul").hide(),b.each(a,function(a,e){var f=b('<li class="item" />').addClass(e.type).data("path",e.path).data("size",e.size);d.options.filemanager&&b('<div class="btns"><a href="#">'+e.name+"</a></div>").append(b('<span class="tools" />').append("folder"==e.type&&b('<span class="zl-btn-small plupload action" title="'+filesPro.translate("Upload files into this folder")+'" />').bind("click",function(){var a=b(this);d.plupload(a.closest("li"),e.path,function(){a.closest("li").addClass("reload"),a.closest(".finderpro .btns").find("a").trigger("click")})})).append("folder"==e.type&&b('<span class="zl-btn-small add action" title="'+filesPro.translate("Create a new subfolder")+'" />').bind("click",function(){var a=b(this);d.Prompt(filesPro.translate("Input a name for the new folder"),filesPro.translate("MyFolder"),a.closest("li"),function(c){c&&a.closest("li").addClass("reload loading")&&b.post(d.options.url+"&method=newfolder",{path:e.path,newfolder:c},function(){a.closest(".btns").find("a").trigger("click")},"json")})})).append(b('<span class="zl-btn-small delete action" title="'+filesPro.translate("Delete")+'" />').click(function(){var a=b(this);d.Confirm(filesPro.translate("You are about to delete")+' "'+e.name+'"',a.closest("li"),function(c){c&&a.closest("li").addClass("loading")&&b.post(d.options.url+"&method=delete",{path:e.path},function(){a.closest("li").fadeOut(400,function(){a.closest("li").remove()})},"json")})}))).appendTo(f),f.appendTo(c.children("ul"))})},plupload:function(a,c,d){var e=this,f=b("<div />").appendTo("body").Plupload({url:e.options.url,path:void 0===c?"":c,extensions:e.options.extensions,fileMode:"files",callback:d});b('<a class="plupload_button plupload_cancel ui-button ui-widget ui-state-default ui-corner-all ui-button-text-icon-primary" />').append(b('<span class="ui-button-icon-primary ui-icon ui-icon-circle-close"></span>')).append(b('<span class="ui-button-text">'+filesPro.translate("Cancel")+"</span>")).bind("hover",function(){b(this).toggleClass("ui-state-hover")}).bind("click",function(){b(this).closest(".qtip").qtip("hide"),e.reset()}).appendTo(f.find(".plupload_buttons")),this.dialogue(f,a,"plupload")},dialogue:function(a,c,d){this.reset(),c.find(".btns").first().addClass("action"),b(c).qtip({content:{text:a},position:{my:"left bottom",at:"top right",viewport:b(window)},show:{ready:!0,solo:!0,delay:0},hide:!1,style:d+" ui-tooltip-custom ui-tooltip-filespro ui-tooltip-light ui-tooltip-rounded ui-tooltip-dialogue",events:{render:function(a,c){b("button",c.elements.content).click(c.hide)},hide:function(a,b){b.destroy()}}})},Confirm:function(a,c,d){var e=b("<p />",{text:a}),f=b("<button />",{text:filesPro.translate("Confirm"),click:function(){d(!0),c.closest(".finderpro").find(".btns").removeClass("action")}}),g=b("<button />",{text:filesPro.translate("Cancel"),click:function(){d(!1),c.closest(".finderpro").find(".btns").removeClass("action")}});this.dialogue(e.add(f).add(g),c)},Prompt:function(a,c,d,e){var f=b("<p />",{text:a}),g=b("<input />",{val:c}),h=b("<button />",{text:filesPro.translate("Confirm"),click:function(){e(g.val()),d.closest(".finderpro").find(".btns").removeClass("action")}}),i=b("<button />",{text:filesPro.translate("Cancel"),click:function(){e(null),d.closest(".finderpro").find(".btns").removeClass("action")}});this.dialogue(f.add(g).add(h).add(i),d)},reset:function(){b(".finderpro").find(".btns").removeClass("action"),b(".qtip").qtip("hide")}}),b.fn[c.prototype.name]=function(){var a=arguments,d=a[0]?a[0]:null;return this.each(function(){var e=b(this);if(c.prototype[d]&&e.data(c.prototype.name)&&"initialize"!=d)e.data(c.prototype.name)[d].apply(e.data(c.prototype.name),Array.prototype.slice.call(a,1));else if(!d||b.isPlainObject(d)){var f=new c;c.prototype.initialize&&f.initialize.apply(f,b.merge([e],a)),e.data(c.prototype.name,f)}else b.error("Method "+d+" does not exist on jQuery."+c.name)})}}(jQuery),function(a){var b=function(){};b.prototype=a.extend(b.prototype,{name:"zluxDialog",options:{width:"300",height:"150",title:"Dialog",classes:""},initialize:function(b,c,d){this.options=a.extend({},this.options,c);var e=this;this.content=a('<div><span class="zlux-loader-horiz" /></div>').insertAfter(b);var e=this,f=e.content.dialog(a.extend({autoOpen:!1,resizable:!1,width:e.options.width,height:e.options.height,dialogClass:"zlux-dialog zl-bootstrap"+(e.options.classes?" "+e.options.classes:""),open:function(){f.position({of:g,my:"left top",at:"right bottom"})},dragStop:function(){window.qtip&&a(".qtip").qtip("reposition")},close:function(){window.qtip&&a(".qtip").qtip("hide")}},e.options)).dialog("widget"),g=a('<span title="'+e.options.title+'" class="files" />').insertAfter(b).bind("click",function(){e.content.dialog(e.content.dialog("isOpen")?"close":"open"),a(this).data("initialized")||d(e),a(this).data("initialized",!0)});a("html").bind("mousedown",function(b){e.content.dialog("isOpen")&&!g.is(b.target)&&!f.find(b.target).length&&!a(b.target).closest(".qtip").length&&e.content.dialog("close")})},loaded:function(){this.content.find(".zlux-loader-horiz").remove()},close:function(){this.content.dialog("close")}}),a.fn[b.prototype.name]=function(){var c=arguments,d=c[0]?c[0]:null;return this.each(function(){var e=a(this);if(b.prototype[d]&&e.data(b.prototype.name)&&"initialize"!=d)e.data(b.prototype.name)[d].apply(e.data(b.prototype.name),Array.prototype.slice.call(c,1));else if(!d||a.isPlainObject(d)){var f=new b;b.prototype.initialize&&f.initialize.apply(f,a.merge([e],c)),e.data(b.prototype.name,f)}else a.error("Method "+d+" does not exist on jQuery."+b.name)})}}(jQuery);