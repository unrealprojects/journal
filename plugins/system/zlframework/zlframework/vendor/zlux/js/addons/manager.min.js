/* ===================================================
 * zlux
 * https://zoolanders.com
 * ===================================================
 * Copyright (C) JOOlanders SL
 * http://www.gnu.org/licenses/gpl-2.0.html
 * ========================================================== */
!function(a,b,c,d,e){"use strict";var f;b.extensions.manager={id:0,init:function(){},getResource:function(a){return a instanceof jQuery?a.data("managerResource"):a},preResourceDelete:function(){},deleteResource:function(c){var d=this,e={url:a.zx.url.ajax("zlux","deleteResource"),data:{type:d.type}};this.preResourceDelete(c,e),b.ajax.request(e).done(function(){c.element.fadeOut("slow",function(){a(this).remove(),d.trigger("resourceDeleted",c)})}).fail(function(){}).always(function(){})},initResources:function(c){var d=this;c=c===e?d.find(".zx-manager-resources"):c,b.assets.load(b.url.get("zlux:js/addons/datatables.min.js")).done(function(){b.datatables(),d.resources=c.dataTable(a.extend(!0,{},b.datatables.settings,d.DTsettings)).DataTable(),d.DT_wrapper=c.closest(".dataTables_wrapper").addClass("uk-hidden"),d.resources.on("init",function(){d.trigger("resourcesInit")}),d.resources.on("click",".zx-x-details-btn",function(){var b=a(this),c=b.closest(".zx-manager-resource"),d=a(".zx-x-details",c);c.hasClass("zx-open")?(b.addClass("uk-icon-angle-down").removeClass("uk-icon-angle-up"),c.removeClass("zx-open"),d.slideUp("fast",function(){})):(c.addClass("zx-open"),b.removeClass("uk-icon-angle-down").addClass("uk-icon-angle-up"),d.slideDown("fast",function(){}))}),d.resources.on("click",".zx-manager-resource .zx-x-name a",function(b){b.preventDefault(),d.trigger("resourceSelected",d.getResource(a(this).closest(".zx-manager-resource")))}),d.resources.on("click",".zx-manager-resource .zx-x-remove",function(c){c.preventDefault();var e=d.getResource(a(this).closest(".zx-manager-resource"));b.notify.confirm(b.lang._("DELETE_THIS_RESOURCE"),{timeout:!1}).done(function(){d.deleteResource(e)})})})},DTsettings:{serverSide:!0}},b.component("managerResource",{data:{editable:!1},defaults:{template:'<div class="zx-x-tools">                                <i class="zx-x-details-btn uk-icon-angle-down" />                                {{#editable}}                                <i class="zx-x-remove uk-icon-minus-circle" data-uk-tooltip title="'+b.lang._("DELETE")+'" />                                {{/some}}                            </div>                            <div class="zx-x-name"><a href="#" class="zx-x-name-link">{{name}}</a></div>                            {{#details && details.length}}                            <div class="zx-x-details">                                <div class="zx-x-messages" />                                <div class="zx-x-details-content">                                    <ul class="uk-list">                                        {{~details}}                                        <li>{{$item}}</li>                                        {{/details}}                                        </ul>                                </div>                            </div>                            {{/end}}'},init:function(){},render:function(){return a.UIkit.Utils.template(this.options.template,this.data)},pushData:function(b){this.data=a.extend({},this.data,b)}}),b.component("managerNav",{defaults:{template:'<ul class="uk-navbar-nav">                                <li class="uk-parent" data-uk-dropdown>                                    <a href=""><i class="uk-icon-bars"></i></a>                                    <div class="uk-dropdown uk-dropdown-navbar">                                        <ul class="uk-nav uk-nav-navbar">                                            <li><a href="">Another item</a></li>                                        </ul>                                    </div>                                </li>                            </ul>                            <div class="uk-navbar-content">                                <form class="uk-form uk-margin-remove uk-display-inline-block">                                   <input type="text" placeholder="Search">                                </form>                            </div>',option_tmpl:'<li><a href=""><i class="uk-icon-{{icon}}"></i> Some text </a></li>'},init:function(){this.element.append(this.options.template)},addChild:function(b){this.find(".uk-dropdown > ul").append(a.UIkit.Utils.template(this.options.option_tmpl,b))}}),b.extensions.managerDropdown=a.extend(!0,{},b.extensions.manager,{defaults:{init_display:"",offsettop:5,template:function(){var a="";return a+='<div class="zx-manager-nav">',a+='<div class="uk-search">',a+='<input class="uk-search-field" type="search" placeholder="search...">',a+='<button class="uk-search-close" type="reset"></button>',a+="</div>",a+="</div>",a+='<div class="zx-manager-spinner uk-text-center"><i class="uk-icon-zx-spinner uk-icon-spin"></i></div>',a+='<table class="uk-table zx-manager-resources"></table>'}},init:function(){var b=this;this.current=this.element.val(),this.hidden=this.element.clone().attr("type","hidden").removeAttr("data-zx-itempicker").insertAfter(this.element),this.element.val(this.options.init_display).removeAttr("name"),this.on("focus",function(){a(".uk-search-field",this.dropdown).focus()}),this.on("resourcesInit",function(){b.DT_wrapper.closest(".dataTables_wrapper").removeClass("uk-hidden"),a(".zx-manager-spinner",this.dropdown).remove()})},initDropdown:function(b){var c=this;if(!b){b=a('<div class="uk-dropdown zx-manager zx"></div>');var d=null;b.on("keyup",".uk-search-field",function(e){var f=a(this).val();""===f?a(".uk-search-close",b).hide():a(".uk-search-close",b).show(),clearTimeout(d),""===f&&c.resources.search("").draw();var g=e.keyCode?e.keyCode:e.which;return 13==g?void c.resources.search(f).draw():void(d=setTimeout(function(){c.resources.search(f).draw()},500))}),b.on("click",".uk-search-close",function(){a(".uk-search-field",b).val(""),a(this).hide(),c.resources.search("").draw()}),b.appendTo("body")}return this.dropdown=b,b},pick:function(b){var d=this.element.offset(),e={top:d.top+this.element.outerHeight()+this.options.offsettop,left:d.left,right:""};this.current=b?b:null,this.inititem=this.current,this.update(),"right"==a.UIkit.langdirection&&(e.right=c.innerWidth-(e.left+this.element.outerWidth()),e.left=""),this.dropdown.css(e).show(),a(".uk-search-field",f).focus()},update:function(){var b=this,c={},d=this.options.template(c,this.options);this.dropdown.html(d),b.on("resourceSelected",function(a,c){b.element.val(c.data.name),b.hidden.val(c.data.id)}),this.initResources(a(".zx-manager-resources",this.dropdown))}})}(jQuery,jQuery.zx,window,document);